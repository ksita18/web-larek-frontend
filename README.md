https://github.com/ksita18/web-larek-frontend.git

# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Данные и типы данных, используемые в приложении

IProduct - интерфейс для описания карточки товара.
Этот интерфейс описывает базовую структуру объекта товара. Он используется для хранения базовой информации о товаре, такой как уникальный идентификатор товара(id), описание товара(description), изображение(image), название товара(title), категория, к которой относится товар(category) и его стоимость(price).
```

 interface IProduct {
    id: string,
    description: string,
    image: string,
    title: string,
    category: TProductCategory,
    price: number | null
}
```
IOrder интерфейс для описания заказа. Включает в себя хранение информации о типе оплаты выбранном покупателем(payment), контактных данных покупателя(address, email, phone), итоговой стоимости заказа(total) и список товаров(items).
```
 interface IOrder {
    payment: string,
    address: string,
    email: string,
    phone: string,
    total: number | null,
    items: TProductId[]
}
```
Категории товара
```
 type TProductCategory = 'софт-скил' | 'другое' | 'дополнительное' | 'кнопка' | 'хард-скил'; 
```
Тип данных для отображения товара в корзине
```
 type TProductBasket = Pick<IProduct, 'title' | 'price'>; 
```
Тип данных для отображения товара на главной странице, без описания
```
 type TProductPage = Pick<IProduct, 'image' | 'category' | 'price' | 'title'>; 
```
Тип данных для отображения товара в модальном окне
```
 type TProductModal = Pick<IProduct, 'description' | 'image' | 'category' | 'price' | 'title'>; 
```
Тип данных для уникального идентификатора товара
```
 type TProductId = Pick<IProduct, 'id'>; 
```
Тип данных полной суммы заказа
```
 type TOrderTotal = Pick<IOrder, 'total'>;
```
Тип данных для вида оплаты и адреса при оформлении заказа
```
 type TOrderPayAddress = Pick<IOrder, 'payment' | 'address'>; 
```
Тип данных для контактов при оформлении заказа
```
 type TOrderContacts = Pick<IOrder, 'email' | 'phone'>; 
```
Интерфейс модели данных карточки
```
interface IProductsData {
    products: IProduct[]; 
    preview: TProductId | null; 
    getProductsList(): IProduct[]; 
    getProduct(productId: TProductId): IProduct; 
    hasInBasket(productId: TProductId, basketProducts: TProductId[]): boolean; 
    hasPriceNull(price: number | null): boolean; 
}
```
Интерфейс модели данных заказа
```
interface IOrderData {
    orderData: IOrder;
    setOrderInfo(orderData: IOrder): void; 
    checkValidation(data: Record<keyof TOrderPayAddress & TOrderContacts, string>): boolean; 
}
```
Интерфейс модели данных корзины
```
interface IBasketData {
    basketProducts: IProduct[]; 
    getBasketProducts(): IProduct[]; 
    addProduct(card: TProductBasket): void; 
    deleteBasketProduct(TProductId: string): void; 
    getTotal(prices: number[] | null): TOrderTotal;
    clearBasketProducts(): void; 
}
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP: 
- слой представления, отвечает за отображение данных на странице, 
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие   

### Слой данных
#### Класс ProductsData
Данный класс отвечает за хранение и логику работы с данными товаров.\
Конструктор класса принимает инстант брокера событий.\
В полях класса хранятся следующие данные:
- `_products: IProduct[]` - массив объектов товаров
- `_preview: TProductId` | null - id товара, для просмотра в модальном окне или добавленного в корзину
- `events: IEvents` - экземпляр класса "EventEmitter" для инициации событий при изменении данных.\

Так же класс представляет собой набор методов для взаимодействия с этими данными:
- `getProductsList(): IProduct[]` - получает массив товаров с сервера
- `getProduct(productId: TProductId): IProduct` - получает товар по id
- `hasInBasket(productId: TProductId, basketProducts: TProductId[]): boolean` - проверяет добавлен ли товар в корзину
- `hasPriceNull(price: number | null): boolean` - проверяет цену на null
- а так же сеттеры и геттеры для хранения и получения данных из полей класса

#### Класс OrderData
Данный класс отвечает за хранение и логику работы с данными заказа товаров.\
Конструктор класса принимает инстант брокера событий.\
В полях класса хранятся следующие данные: 
- `payment: string` - способ оплаты заказа
- `address: string` - адрес покупателя
- `email: string` - электронная почта покупателя
- `phone: string` - телефон покупателя
- `total: number | null` - итоговая стоимость заказа
- `items: IProduct[]` - итоговый список товаров
- `orderData: IOrder` - объект заказа
- `events: IEvents` - экземпляр класса "EventEmitter" для инициации событий при изменении данных.\

Так же класс представляет собой набор методов для взаимодействия с этими данными: 
- `setOrderInfo(orderData: IOrder): void` - отправляет данные для оформления заказа на сервер
- `checkValidation(data: Record<keyof TOrderPayAddress & TOrderContacts, string>): boolean` - проверяет валидацию данных в форме

#### Класс BasketData
Данный класс отвечает за хранение и логику работы с данными заказа в корзине.\
Конструктор класса принимает инстант брокера событий.\
В полях класса хранятся следующие данные: 
- `basketProducts: IProduct[]` - список добавленных в корзину товаров
- `events: IEvent`s - экземпляр класса "EventEmitter" для инициации событий при изменении данных.\

Так же класс представляет собой набор методов для взаимодействия с этими данными:
- `getBasketProducts(): IProduct[]` - получает список добавленных в корзину товаров
- `addProduct(product: TProductBasket): void` - добавляет товар в корзину, при условии, что он еще не добавлен
- `deleteBasketProduct(TProductId: string): void` - удаляет товар из корзины
- `getTotal(prices: number[] | null): TOrderTotal` - получает общую суммы заказа
- `clearBasketProducts(): void` - удаление всех товаров из корзины после успешного оформления заказа
- а так же сеттеры и геттеры для хранения и получения данных из полей класса

### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Базовый Класс Component

Класс является дженериком и родителем всех компонентов слоя представления. В дженерик принимает тип объекта, в котором данные будут передаваться в метод `render` для отображения данных в компоненте.\
В конструктор принимает элемент разметки, являющийся основным родительским контейнером компонента. Содержит метод `render`, отвечающий за сохранение полученных в параметре данных в полях компонентов через их сеттеры, возвращает обновленный контейнер компонента.

#### Класс Modal
Реализует модальное окно. Так же предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа.  
- constructor(selector: string, events: IEvents) Конструктор принимает селектор, по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса
- modal: HTMLElement - элемент модального окна
- events: IEvents - брокер событий

#### Класс ProductModal

Расширяет класс Modal. Реализует модальное окно с данными карточки товара.\
При сабмите инициирует событие, добавляя товар в корзину. Управляет активностью кнопки добавления при нулевой стоимости или если товар уже добавлен в корзину.\
Поля класса:
- `submitButton: HTMLButtonElement` - кнопка добавления товара в корзину;

Методы класса:
- `getProduct(productId: string): IProduct` - возвращает карточку товара по id

#### BasketModal

Расширяет класс Modal. Реализует модальное окно с отображением корзины. При открытии получает общую сумму заказа и список товаров в корзине.\
При сабмите инициирует событие оформления заказа.\
Поля класса:
- `submitButton: HTMLButtonElement` - кнопка оформления заказа;
- `productList: HTMLListElement` - элемент разметки со списком товаров в корзине;
- `totalBasketPrice: HTMLElement` - элемент разметки с общей суммой заказа

Методы класса:
- `render(products: HTMLElement): void` - добавление собранного элемента разметки.

#### Класс FormModal

Расширяет класс Modal. Реализует модальное окно с формой, содержащей поля ввода.\
При сабмите инициирует событие, передавая в него объект с данными из полей ввода формы. При изменении данных в полях ввода инициирует событие изменения данных.\
Предоставляет методы для отображения ошибок и управления активностью кнопки сохранения.

Поля класса:

- `submitButton: HTMLButtonElement` - кнопка подтверждения;
- `_form: HTMLFormElement` - элемент формы;
- `formName: string` - значение атрибута name формы;
- `inputs: NodeListOf<HTMLInputElement>` - коллекция всех полей ввода формы;
- `errors: Record<string, HTMLElement>` - объект хранящий все элементы для вывода ошибок под полями формы с привязкой к атрибуту name инпутов.

Методы:

- `setValid(isValid: boolean): void` - изменяет активность кнопки подтверждения;
- `getInputValues(): Record<string, string>` - возвращает объект с данными из полей формы, где ключ - name инпута, значение - данные введенные пользователем;
- `setInputValues(data: Record<string, string>): void` - принимает объект с данными для заполнения полей формы;
- `setError(data: { field: string, value: string, validInformation: string }): void` - принимает объект с данными для отображения или сокрытия текстов ошибок под полями ввода;
- `showInputError (field: string, errorMessage: string): void` - отображает полученный текст ошибки под указанным полем ввода;
- `hideInputError (field: string): void` - очищает текст ошибки под указанным полем ввода;
- `close (): void` - расширяет родительский метод дополнительно при закрытии очищая поля формы и деактивируя кнопку сохранения;
- `get form: HTMLElement` - геттер для получения элемента формы.

#### Класс SuccessOrderModal

Расширяет класс Modal. Реализует модальное окно с отображением успешно оформленного заказа.\
При сабмите переходит на главную страницу. При открытии отображает итоговую сумму заказа. При закрытии очищает корзину.

Поля класса: 
- `_total: HTMLElement` - элемент разметки для вывода итоговой суммы;
- `submitButton: HTMLButtonElement` - кнопка перехода на главную страницу.

Методы:
- `close(): void` - расширяет родительский метод. Дополнительно при закрытии очищает корзину.

#### Класс CardProduct
Отвечает за отображение карточки товара, задавая в карточке данные названия, изображения, категории и стоимости.\
Класс используется для отображения карточек товара на странице сайта. В конструктор класса передается DOM элемент темплейта, что позволяет при необходимости формировать карточки разных вариантов верстки. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются соответствующие события.\
Поля класса содержат элементы разметки элементов карточки. Конструктор, кроме темплейта принимает экземпляр `EventEmitter` для инициации событий.\
Методы:
- `render(cardProductData: Partial<IProduct>, productId: TProductId): HTMLElement` - расширяет родительский метод. Заполняет атрибуты элементов карточки данными и управляет поведением кнопки добавления.
Кнопка будет доступна, если цена в карточке не null и будет менять свой текст при проверке на наличии карточки в корзине. Метод возвращает разметку карточки с установленными слушателями.
Слушатели устанавливаются на все интерактивные элементы карточки и генерируют соответствующие события через экземпляр брокера событий.
- геттер _id возвращает уникальный id карточки

### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

_Список всех событий, которые могут генерироваться в системе:_  

_События изменения данных (генерируются классами моделями данных)_  
`products:changed` - изменение списка товаров  
_События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)_:   
`basket:add-product` - добавление товара в корзину  
`basket:remove-product` - удаление товара из корзины  
`basket:create-order` - оформление заказа  
`basket:open` - открытие корзины пользователя  
`product:preview` - открытие модального окна с товаром  
`form:errors-changed` - показ(скрытие) ошибок формы  
`order:open` - открытие формы заказа  
`order:clear` - очистка формы заказа  
`order:set-payment-type` - выбор типа оплаты  
`modal:open` - открытие модального окна  
`modal:close` - закрытие модального окна  